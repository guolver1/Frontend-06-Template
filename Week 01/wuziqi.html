<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <style>
        .cell {
            width: 30px;
            height: 30px;
            font-size: 30px;
            line-height: 30px;
            text-align: center;
            background-color: green;
            display: inline-block;
            border: 1px solid white;
            vertical-align: middle;
            color: red;
        }
    </style>
    <div id="board"></div>
    <script>
        let boardSize = 15;
        let pattern = Array.from({length:boardSize}).map(_ => Array.from({length:boardSize}).fill(0));
        let meWin = [];
        let computerWin = [];
        let color = 1;
        let count = 0; 
        let gameOver = false;

        let wins = Array.from({length:boardSize}).map(
                        _ => Array.from({length:boardSize}).map(
                                _ => Array.from({length:5}).fill(null)
                            )
                        );

        function show() {
            let board = document.getElementById("board");

            board.innerHTML = "";

            for (let i = 0; i < boardSize; i++) {
                for (let j = 0; j < boardSize; j++) {
                    let cell = document.createElement("div");
                    cell.classList.add("cell");
                    cell.innerText =
                        pattern[i][j] == 2 ? "×" :
                            pattern[i][j] == 1 ? "o" : "";
                    cell.addEventListener("click", () => move(i, j))
                    board.appendChild(cell);
                }
                board.appendChild(document.createElement("br"));
            }
        }
        //五子棋赢得方法的三维数组，count为第几种赢法
        function getWinArray(){

            //垂直方向
            for(let i=0;i<boardSize;i++){
                for(let j=0;j<boardSize-4;j++){
                    for(let k=0;k<5;k++){
                        wins[i][j+k][count]=true; 
                    }
                    count++;
                }
            }

            //水平方向
            for(let i=0;i<boardSize;i++){
                for(let j=0;j<boardSize-4;j++){
                    for(let k=0;k<5;k++){
                        wins[j+k][i][count]=true;
                    }
                    count++;
                }
            }

            //斜向
            for(let i=0;i<boardSize-4;i++){
                for(let j=0;j<boardSize-4;j++){
                    for(let k=0;k<5;k++){
                        wins[i+k][j+k][count]=true;
                    }
                    count++;
                }
            }
            //逆斜向
            for(let i=0;i<boardSize-4;i++){
                for(let j=boardSize-1;j>3;j--){
                    for(let k=0;k<5;k++){
                        wins[i+k][j-k][count]=true;
                    }
                    count++;
                }
            };
           
            meWin = Array.from({length:count}).fill(0);
            computerWin = Array.from({length:count}).fill(0);
        }
        
        getWinArray();

        function move(x, y) {
            pattern[x][y] = color;
            color = 3 - color;
            
            updateWin(x,y,1);


            if(!gameOver){
                computerAI();
            }
                        
        }
        function updateWin(x,y,color){
            for(let k =0; k<count;k++){
                if(wins[x][y][k]){
                    if(color==1){
                        meWin[k]++;
                        computerWin[k]=6;
                        if(meWin[k]==5){
                            alert('你赢了');
                            gameOver = true;
                            break;
                        }
                    } 
                    else if(color==2){

                        computerWin[k]++;
                        meWin[k]=6;
                        if(computerWin[k]==5){
                            alert('计算机赢了');
                            gameOver = true;
                            break;
                        }
                    }
                }

            }  
            console.log(computerWin)

        }
        function computerAI(){
            
            let myScore = Array.from({length:boardSize}).map(_ => Array.from({length:boardSize}).fill(0));
            let computerScore = Array.from({length:boardSize}).map(_ => Array.from({length:boardSize}).fill(0));
            let max = 0;
            let u = 0, v = 0;

            for(let i=0; i<boardSize; i++){
                for(let j=0;j<boardSize;j++){
                    if(pattern[i][j]==0){//没有落子
                        for(let k=0; k<count;k++){
                            if(wins[i][j][k]){//有价值的落点，如果某一个i,j出现在了多种赢法上，其分数将进行累加
                                //计算机计算我方得分，考虑拦截
                                switch(meWin[k]){
                                    case 1: 
                                        myScore[i][j]+=200;
                                        break;
                                    case 2: 
                                        myScore[i][j]+=260;
                                        break;
                                    case 3: 
                                        myScore[i][j]+=2000;
                                        break;
                                    case 4: 
                                        myScore[i][j]+=10000;
                                        break;
                                    default:
                                        break;
                                    }
                                    //计算机方得分
                                switch(computerWin[k]){
                                    case 1: 
                                        computerScore[i][j]+=300;
                                        break;
                                    case 2: 
                                        computerScore[i][j]+=500;
                                        break;
                                    case 3: 
                                        computerScore[i][j]+=2500;
                                        break;
                                    case 4: 
                                        computerScore[i][j]+=20000;
                                        break;
                                    default:
                                        break;
                                    }
                                    
                            }
                        }
                        
                        //获取myScore和computerScore里分数最高的点
                        if(myScore[i][j]>max){
                            max = myScore[i][j];
                            u=i;
                            v=j;
                            
                        }else if(myScore[i][j]== max){
                            if(computerScore[i][j]>=computerScore[u][v]){
                                u=i;
                                v=j;
                            }
                        }
                    
                        if(computerScore[i][j]>max){
                            max = computerScore[i][j];
                            u=i;
                            v=j;
                            
                        }else if(computerScore[i][j] == max){
                            if(myScore[i][j]>=myScore[u][v]){
                                u=i;
                                v=j;
                                
                            }
                        }
                    } 
                }
            }
            pattern[u][v]=color;
            updateWin(u,v,2);

            
            show();
            color = 3 - color;


        }
        show();
    </script>
</body>

</html>